fragment RoomDetailsFragment on Room {
  id
  shortId
  name
  description
  descriptionRendered
  language
  focusModeEnabled
}

fragment RoomStats on RoomStats {
  id
  activeMemberCount
}

fragment RoomMembership on RoomMembership {
  room {
    ...RoomDetailsFragment
    stats {
      ...RoomStats
    }
  }
  role
}

fragment RoomMember on RoomMember {
  user {
    id
    displayId
    displayName
    verified
  }
  role
}

query RoomIdByShortId($shortId: String!) {
  roomByShortId(shortId: $shortId) {
    id
  }
}

query RoomLanguageByShortId($shortId: String!) {
  roomByShortId(shortId: $shortId) {
    language
  }
}

query RoomById($id: ID!) {
  roomById(id: $id) {
    ...RoomDetailsFragment
  }
}

query RoomFocusModeEnabledById($id: ID!) {
  roomById(id: $id) {
    focusModeEnabled
  }
}

query RoomByShortId($shortId: String!) {
  roomByShortId(shortId: $shortId) {
    ...RoomDetailsFragment
  }
}

query Rooms($room: RoomQueryInput!, $cursor: String) {
  rooms(room: $room, first: 10, after: $cursor) {
    edges {
      node {
        ...RoomDetailsFragment
      }
      cursor
    }
    pageInfo {
      endCursor
      hasNextPage
      hasPreviousPage
      startCursor
    }
  }
}

query RoomMembershipById($roomId: UUID!) {
  roomMembershipById(roomId: $roomId) {
    ...RoomMembership
  }
}

query RoomMembershipByShortId($shortId: String!) {
  roomMembershipByShortId(shortId: $shortId) {
    ...RoomMembership
  }
}

query RoomByShortId($shortId: String!) {
  roomByShortId(shortId: $shortId) {
    ...RoomDetailsFragment
  }
}

query RoomMembershipById($roomId: UUID!) {
  roomMembershipById(roomId: $roomId) {
    ...RoomMembership
  }
}

query RoomMemberships($query: RoomQueryInput, $cursor: String) {
  roomMemberships(query: $query, first: 10, after: $cursor) {
    edges {
      node {
        ...RoomMembership
      }
      cursor
    }
    pageInfo {
      endCursor
      hasNextPage
      hasPreviousPage
      startCursor
    }
  }
}

query RoomsByUserId($userId: UUID!, $cursor: String) {
  roomsByUserId(userId: $userId, first: 10, after: $cursor) {
    edges {
      node {
        ...RoomMembership
      }
      cursor
    }
    pageInfo {
      endCursor
      hasNextPage
      hasPreviousPage
      startCursor
    }
  }
}

query RoomStatsById($id: ID!) {
  roomById(id: $id) {
    stats {
      ...RoomStats
    }
  }
}

mutation JoinRoom($shortId: ID!) {
  joinRoom(input: { shortId: $shortId }) {
    ...RoomMembership
  }
}

mutation CreateRoom($name: String!) {
  createRoom(input: { name: $name }) {
    id
    shortId
  }
}

mutation DeleteRoom($id: ID!) {
  deleteRoom(id: $id)
}

mutation DuplicateRoom($id: ID!, $newName: String!) {
  duplicateRoom(input: { id: $id, newName: $newName }) {
    id
    shortId
  }
}

# Using one combined mutation because of the existing component behavior.
# This should be split up later with settings UX improvements.
mutation UpdateRoomDetails(
  $id: ID!
  $name: String!
  $description: String!
  $languageCode: String
) {
  updateRoomName(id: $id, name: $name) {
    id
    name
  }
  updateRoomDescription(id: $id, description: $description) {
    id
    description
    descriptionRendered
  }
  updateRoomLanguage(id: $id, languageCode: $languageCode) {
    id
    language
  }
}

mutation UpdateRoomLanguage($id: ID!, $languageCode: String!) {
  updateRoomLanguage(id: $id, languageCode: $languageCode) {
    id
    language
  }
}

mutation UpdateRoomFocusMode($id: ID!, $enabled: Boolean!) {
  updateRoomFocusMode(id: $id, enabled: $enabled) {
    id
    focusModeEnabled
  }
}

query RoomManagingMembersByRoomId($roomId: UUID!) {
  roomManagingMembersByRoomId(roomId: $roomId) {
    ...RoomMember
  }
}

mutation GrantRoomRole($roomId: UUID!, $userId: UUID!, $role: RoomRole!) {
  grantRoomRole(roomId: $roomId, userId: $userId, role: $role) {
    room {
      id
    }
    user {
      id
    }
    role
  }
}

mutation GrantRoomRoleByInvitation(
  $roomId: UUID!
  $mailAddress: String!
  $role: RoomRole!
) {
  grantRoomRoleByInvitation(
    roomId: $roomId
    mailAddress: $mailAddress
    role: $role
  ) {
    room {
      id
    }
    user {
      id
    }
    role
  }
}

mutation RevokeRoomRole($roomId: UUID!, $userId: UUID!) {
  revokeRoomRole(roomId: $roomId, userId: $userId) {
    room {
      id
    }
    user {
      id
    }
  }
}

mutation RevokeRoomMembership($roomId: UUID!) {
  revokeRoomMembership(roomId: $roomId) {
    room {
      id
    }
  }
}
